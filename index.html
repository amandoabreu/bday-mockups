<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RSVP Flow — v3</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root{--peach:#fff7f4;--orange:#f8a88e;--orange-light:#fad2c3;--blue:#7bb6ff;--green:#8cd9a2;--gray:#f3f4f6;}
    body{font-family:'Inter',sans-serif;}
  </style>
</head>
<body class="bg-[var(--peach)] min-h-screen flex flex-col items-center py-12">
  <h1 class="text-3xl font-bold mb-6">RSVP Prototype (v1.0)</h1>

  <!-- TABS -->
  <div class="flex gap-4 mb-8">
    <button data-tab="parent"   class="tab-btn rounded-full px-5 py-2 text-sm font-medium shadow bg-white">Parent</button>
    <button data-tab="guest"    class="tab-btn rounded-full px-5 py-2 text-sm font-medium shadow bg-white">Guest</button>
    <button data-tab="provider" class="tab-btn rounded-full px-5 py-2 text-sm font-medium shadow bg-white">Provider</button>
  </div>

  <!-- PANELS -->
  <div class="w-full max-w-3xl px-4 space-y-10">
    <!-- PARENT PANEL -->
    <section id="parent" class="tab-panel hidden">
      <div class="bg-white rounded-3xl shadow-xl p-6 space-y-6">
        <h2 class="text-lg font-semibold text-center">Parent</h2>
        
        <!-- Invite Guests Button -->
        <button onclick="openInviteModal()" class="w-full py-3 rounded-xl bg-[var(--blue)] text-white font-medium flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Invite Guests
        </button>

        <!-- Invite link explain that this can be sent directly  to the guest -->
        <!-- <div class="flex items-center gap-2 text-sm">
          <input id="inviteLink" readonly value="https://party.ly/jackson-6-9" class="flex-1 border rounded-lg px-2 py-1 text-xs bg-[var(--gray)]"/>
          <button id="copyLink" class="px-3 py-1 rounded-lg bg-[var(--blue)] text-white text-xs">Copy</button>
        </div> -->
        <!-- Progress bar -->
        <p class="text-sm font-medium">Planning progress</p>
        <div class="w-full h-2 rounded-full bg-[var(--orange-light)]">
          <div class="h-2 rounded-full bg-[var(--orange)]" style="width:60%"></div>
        </div>
        <!-- Guest list -->
        <h3 class="text-sm font-medium">Guests</h3>
        <table class="w-full text-xs">
          <thead class="text-left text-gray-500">
            <tr><th>Name</th><th class="text-center">RSVP</th><th class="text-center">Waiver signed</th></tr>
          </thead>
          <tbody class="divide-y text-gray-700">
            <tr><td>Olivia</td><td class="text-center text-green-600">Yes</td><td class="text-center text-green-600">✔︎</td></tr>
            <tr><td>James</td><td class="text-center text-red-400">No</td><td class="text-center text-gray-400">—</td></tr>
            <tr><td>Jack</td><td class="text-center text-yellow-500">Maybe</td><td class="text-center text-gray-400">—</td></tr>
            <tr><td>Jesse</td><td class="text-center text-green-600">Yes</td><td class="text-center text-green-600">✔︎</td></tr>
          </tbody>
        </table>
        <!-- Add‑ons quick picker -->
        <details class="border rounded-lg p-4">
          <summary class="cursor-pointer text-sm font-medium">Add‑ons & Upgrades</summary>
          <div class="mt-3 space-y-2 text-sm">
            <label class="flex justify-between items-center">
              <div>
                <span>Balloon Bundle</span>
                <span class="text-xs text-gray-500 ml-2">$49</span>
              </div>
              <input type="checkbox" class="accent-[var(--orange)]" onchange="updateTotal()" data-price="49" name="addon">
            </label>
            <label class="flex justify-between items-center">
              <div>
                <span>Photographer</span>
                <span class="text-xs text-gray-500 ml-2">$149</span>
              </div>
              <input type="checkbox" class="accent-[var(--orange)]" onchange="updateTotal()" data-price="149" name="addon">
            </label>
            <label class="flex justify-between items-center">
              <div>
                <span>Extra 30 min play</span>
                <span class="text-xs text-gray-500 ml-2">$79</span>
              </div>
              <input type="checkbox" class="accent-[var(--orange)]" onchange="updateTotal()" data-price="79" name="addon">
            </label>
            <div class="text-xs text-gray-500 mt-4">
              <span class="font-medium text-[var(--orange)]">Multi-item discount:</span>
              <ul class="mt-1 space-y-1 pl-4">
                <li>• 2 add-ons: 10% off add-ons</li>
                <li>• 3+ add-ons: 15% off add-ons</li>
              </ul>
            </div>
          </div>
        </details>
        <!-- Balance -->
        <div class="flex justify-between text-sm font-medium">
          <span>Base Package</span>
          <span>$299.00</span>
        </div>
        <div id="addonsTotal" class="flex justify-between text-sm text-[var(--orange)] hidden">
          <span>Add-ons Subtotal</span>
          <span>$0.00</span>
        </div>
        <div id="discount" class="flex justify-between text-sm text-green-600 hidden">
          <span>Multi-item Discount</span>
          <span>-$0.00</span>
        </div>
        <div class="flex justify-between text-sm font-medium">
          <span>Total Due</span>
          <span id="totalDue">$299.00</span>
        </div>
        <button class="w-full py-2 rounded-xl bg-[var(--orange)] text-white">Pay balance</button>

        <script>
          function updateTotal() {
            const basePrice = 299;
            const addons = document.querySelectorAll('input[name="addon"]:checked');
            const addonsTotal = Array.from(addons).reduce((sum, addon) => sum + Number(addon.dataset.price), 0);
            
            // Calculate discount
            let discount = 0;
            if (addons.length >= 3) {
              discount = addonsTotal * 0.15; // 15% off for 3+ items
            } else if (addons.length === 2) {
              discount = addonsTotal * 0.10; // 10% off for 2 items
            }
            
            // Update UI
            const addonsTotalElement = document.getElementById('addonsTotal');
            const discountElement = document.getElementById('discount');
            const totalDueElement = document.getElementById('totalDue');
            
            if (addonsTotal > 0) {
              addonsTotalElement.classList.remove('hidden');
              addonsTotalElement.querySelector('span:last-child').textContent = `$${addonsTotal.toFixed(2)}`;
            } else {
              addonsTotalElement.classList.add('hidden');
            }
            
            if (discount > 0) {
              discountElement.classList.remove('hidden');
              discountElement.querySelector('span:last-child').textContent = `-$${discount.toFixed(2)}`;
            } else {
              discountElement.classList.add('hidden');
            }
            
            const total = basePrice + addonsTotal - discount;
            totalDueElement.textContent = `$${total.toFixed(2)}`;
          }
          
          // Initialize total
          updateTotal();
        </script>
      </div>

      <!-- Invite Modal -->
      <div id="inviteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md mx-4">
          <div class="p-6 space-y-6">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-semibold">Invite Guests</h3>
              <button onclick="closeInviteModal()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <!-- Contact Import Button -->
            <div id="contactPickerContainer" class="mb-4 space-y-2">
              <!-- Android/Chrome Contact Picker -->
              <button onclick="pickContacts()" class="w-full py-2 rounded-xl border-2 border-[var(--blue)] text-[var(--blue)] hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 contact-picker-btn">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                Import from Contacts
              </button>
            </div>

            <!-- Guest List -->
            <div id="guestList" class="space-y-4">
              <!-- Guest entries will be added here -->
            </div>

            <script>
              // Detect iOS
              function isIOS() {
                return [
                  'iPad Simulator',
                  'iPhone Simulator',
                  'iPod Simulator',
                  'iPad',
                  'iPhone',
                  'iPod'
                ].includes(navigator.platform)
                // iPad on iOS 13 detection
                || (navigator.userAgent.includes("Mac") && "ontouchend" in document);
              }

              // Initialize platform-specific buttons
              document.addEventListener('DOMContentLoaded', () => {
                const contactPickerContainer = document.getElementById('contactPickerContainer');
                const contactPickerBtn = contactPickerContainer.querySelector('button');
                
                if (isIOS()) {
                  // Replace the button text and icon for iOS
                  contactPickerBtn.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                    </svg>
                    Open Contacts App
                  `;
                  contactPickerBtn.onclick = openIOSContacts;
                } else if (!('contacts' in navigator && 'ContactsManager' in window)) {
                  // If neither is supported, hide the entire container
                  contactPickerContainer.style.display = 'none';
                }
              });

              // iOS Contacts Integration
              function openIOSContacts() {
                // Create a deep link to the iOS Contacts app
                window.location.href = 'contacts://';
                
                // Show instructions toast
                const toast = document.createElement('div');
                toast.className = 'fixed top-4 right-4 bg-white text-gray-800 px-6 py-4 rounded-lg shadow-xl space-y-2 max-w-xs';
                toast.innerHTML = `
                  <div class="font-medium">How to share contacts:</div>
                  <ol class="text-sm space-y-2 list-decimal pl-4">
                    <li>Select contacts in the Contacts app</li>
                    <li>Tap Share Contact</li>
                    <li>Choose "Copy"</li>
                    <li>Return here and paste</li>
                  </ol>
                  <button onclick="showContactPasteUI()" class="mt-3 w-full py-2 bg-[var(--blue)] text-white rounded-lg text-sm">
                    I've copied contacts
                  </button>
                `;
                document.body.appendChild(toast);

                // Add close button
                const closeBtn = document.createElement('button');
                closeBtn.className = 'absolute top-2 right-2 text-gray-400 hover:text-gray-600';
                closeBtn.innerHTML = `
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                `;
                closeBtn.onclick = () => toast.remove();
                toast.appendChild(closeBtn);
              }

              // Show paste UI for iOS contacts
              function showContactPasteUI() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                  <div class="bg-white rounded-2xl w-full max-w-md mx-4 p-6 space-y-4">
                    <div class="text-lg font-semibold">Paste Contacts</div>
                    <textarea 
                      class="w-full h-32 border rounded-lg px-3 py-2 text-sm" 
                      placeholder="Paste your copied contacts here..."
                      onpaste="handleContactPaste(event)"
                    ></textarea>
                    <div class="text-sm text-gray-500">
                      Paste the contacts you copied from the Contacts app here
                    </div>
                    <div class="flex justify-end gap-2">
                      <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 border rounded-lg text-sm">
                        Cancel
                      </button>
                    </div>
                  </div>
                `;
                document.body.appendChild(modal);

                // Close when clicking outside
                modal.addEventListener('click', (e) => {
                  if (e.target === modal) modal.remove();
                });
              }

              // Handle pasted contact data
              function handleContactPaste(event) {
                const pastedText = event.clipboardData.getData('text');
                
                // Parse the pasted text for contact information
                // This is a simple example - you might want to enhance the parsing logic
                const contacts = parseContactsFromText(pastedText);
                
                if (contacts.length > 0) {
                  // Add the contacts to the guest list
                  contacts.forEach(contact => {
                    addGuestEntry(contact.name, contact.email, contact.phone);
                  });

                  // Show success message
                  const toast = document.createElement('div');
                  toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in';
                  toast.textContent = `${contacts.length} contact${contacts.length === 1 ? '' : 's'} added`;
                  document.body.appendChild(toast);
                  setTimeout(() => toast.remove(), 3000);

                  // Close the paste modal
                  event.target.closest('.fixed').remove();
                }
              }

              // Parse contacts from pasted text
              function parseContactsFromText(text) {
                // This is a simple parser - you might want to enhance it based on your needs
                const contacts = [];
                
                // Split by double newlines (usually separates contacts)
                const entries = text.split(/\n\s*\n/);
                
                entries.forEach(entry => {
                  const lines = entry.split('\n');
                  const contact = {
                    name: '',
                    email: '',
                    phone: ''
                  };

                  lines.forEach(line => {
                    line = line.trim();
                    if (line.match(/@/)) {
                      contact.email = line;
                    } else if (line.match(/[\d-+()]/)) {
                      contact.phone = line;
                    } else if (line) {
                      contact.name = line;
                    }
                  });

                  if (contact.name || contact.email || contact.phone) {
                    contacts.push(contact);
                  }
                });

                return contacts;
              }

              async function pickContacts() {
                // Check if the Contact Picker API is supported
                if ('contacts' in navigator && 'ContactsManager' in window) {
                  try {
                    const properties = ['name', 'email', 'tel'];
                    const opts = {multiple: true};
                    
                    const contacts = await navigator.contacts.select(properties, opts);
                    
                    contacts.forEach(contact => {
                      // Create a new guest entry for each selected contact
                      const guestList = document.getElementById('guestList');
                      const entryId = Date.now() + Math.random(); // Unique ID
                      
                      const entry = document.createElement('div');
                      entry.className = 'guest-entry bg-[var(--gray)] rounded-xl p-4 relative';
                      
                      const name = contact.name?.[0] || '';
                      const email = contact.email?.[0] || '';
                      const phone = contact.tel?.[0] || '';
                      
                      entry.innerHTML = `
                        <button onclick="removeGuestEntry(${entryId})" class="absolute right-2 top-2 text-gray-400 hover:text-gray-600">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                          </svg>
                        </button>
                        <div class="space-y-3">
                          <input type="text" placeholder="Guest Name" value="${name}" class="w-full border rounded-lg px-3 py-2 text-sm" />
                          <div class="grid grid-cols-7 gap-2 items-center">
                            <input type="email" placeholder="Email" value="${email}" class="col-span-3 border rounded-lg px-3 py-2 text-sm" />
                            <div class="text-center text-sm text-gray-400">or</div>
                            <input type="tel" placeholder="Phone" value="${phone}" class="col-span-3 border rounded-lg px-3 py-2 text-sm" />
                          </div>
                        </div>
                      `;
                      
                      guestList.appendChild(entry);
                    });
                    
                    // Show success message if contacts were imported
                    if (contacts.length > 0) {
                      const toast = document.createElement('div');
                      toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in';
                      toast.textContent = `${contacts.length} contact${contacts.length === 1 ? '' : 's'} imported`;
                      document.body.appendChild(toast);
                      setTimeout(() => toast.remove(), 3000);
                    }
                  } catch (error) {
                    console.error('Error picking contacts:', error);
                    // Show error message
                    const toast = document.createElement('div');
                    toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in';
                    toast.textContent = 'Could not access contacts. Please add manually.';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 3000);
                  }
                } else {
                  // Hide the contact picker button if not supported
                  document.getElementById('contactPickerContainer').style.display = 'none';
                }
              }

              // Check contact picker support on page load
              document.addEventListener('DOMContentLoaded', () => {
                if (!('contacts' in navigator && 'ContactsManager' in window)) {
                  document.getElementById('contactPickerContainer').style.display = 'none';
                }
              });
            </script>

            <!-- Add Guest Button -->
            <button onclick="addGuestEntry()" class="w-full py-2 rounded-xl border-2 border-dashed border-gray-300 text-gray-500 hover:border-[var(--blue)] hover:text-[var(--blue)] transition-colors">
              + Add Another Guest
            </button>

            <!-- Send Invites Button -->
            <button onclick="sendInvites()" class="w-full py-2 rounded-xl bg-[var(--orange)] text-white font-medium">
              Send Invites
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- GUEST PANEL -->
    <section id="guest" class="tab-panel hidden">
      <div class="bg-white rounded-3xl shadow-xl p-6 space-y-6">
        <h2 class="text-lg font-semibold text-center">Guest RSVP</h2>
        <!-- Hero Banner -->
        <div class="relative h-48 rounded-xl overflow-hidden">
          <img src="x.jpg" class="absolute inset-0 w-full h-full object-cover" alt="Party banner" />
          <div class="absolute inset-0 bg-gradient-to-b from-black/30 to-black/60"></div>
          <div class="absolute inset-0 flex flex-col items-center justify-center text-white p-6 text-center">
            <div class="text-3xl font-bold mb-2">Jackson's 6th Birthday!</div>
            <div class="text-lg mb-1">Join us for an amazing adventure</div>
            <div class="text-sm opacity-90">Saturday, March 23rd</div>
          </div>
        </div>
        
        <!-- Location Map -->
        <div class="space-y-2">
          <h3 class="font-medium">Location</h3>
          <div class="rounded-xl overflow-hidden shadow-sm border">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3153.0679167817813!2d-122.41941674847465!3d37.77492797975892!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8085809c6c8f4459%3A0xb10ed6d9b5050fa5!2sKids%20Party%20Space!5e0!3m2!1sen!2sus!4v1679TBD"
              width="100%"
              height="200"
              style="border:0;"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              class="w-full"
            ></iframe>
          </div>
          <div class="text-sm text-gray-600">
            <div>Kids Party Space</div>
            <div>123 Fun Street</div>
            <div>San Francisco, CA 94103</div>
          </div>
        </div>

        <!-- Weather Forecast -->
        <div class="space-y-2">
          <h3 class="font-medium">Weather Forecast</h3>
          <div class="bg-[var(--gray)] rounded-xl p-4">
            <div class="flex items-center gap-4">
              <!-- Weather icon -->
              <div class="w-14 h-14 flex items-center justify-center bg-white rounded-xl shadow-sm">
                <svg class="w-8 h-8 text-[var(--orange)]" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 3v2m0 14v2M5.64 5.64l1.41 1.41m10.3 10.3 1.41 1.41M3 12h2m14 0h2M5.64 18.36l1.41-1.41m10.3-10.3 1.41-1.41M12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10z"/>
                </svg>
              </div>
              <!-- Weather details -->
              <div class="flex-1">
                <div class="text-lg font-medium">72°F</div>
                <div class="text-sm text-gray-600">Sunny</div>
                <div class="text-xs text-gray-500">Saturday, March 23rd</div>
              </div>
              <!-- Additional info -->
              <div class="text-right text-sm text-gray-600">
                <div>Humidity: 65%</div>
                <div>Wind: 8 mph</div>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t text-xs text-gray-500">
              Note: This is a forecast and may change. Please check again closer to the event date.
            </div>
          </div>
        </div>

        <!-- Timeline -->
        <div class="relative">
          <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-[var(--orange-light)]"></div>
          <div class="space-y-6 relative">
            <div class="flex gap-4 items-start">
              <div class="w-2 h-2 rounded-full bg-[var(--orange)] mt-2 relative z-10"></div>
              <div>
                <div class="font-medium">2:00 PM - Arrival</div>
                <div class="text-sm text-gray-600">Check in at the front desk</div>
              </div>
            </div>
            <div class="flex gap-4 items-start">
              <div class="w-2 h-2 rounded-full bg-[var(--orange)] mt-2 relative z-10"></div>
              <div>
                <div class="font-medium">2:15 PM - Welcome & Safety Brief</div>
                <div class="text-sm text-gray-600">Get ready for fun!</div>
              </div>
            </div>
            <div class="flex gap-4 items-start">
              <div class="w-2 h-2 rounded-full bg-[var(--orange)] mt-2 relative z-10"></div>
              <div>
                <div class="font-medium">2:30 PM - Activities Begin</div>
                <div class="text-sm text-gray-600">Games, climbing, and more</div>
              </div>
            </div>
            <div class="flex gap-4 items-start">
              <div class="w-2 h-2 rounded-full bg-[var(--orange)] mt-2 relative z-10"></div>
              <div>
                <div class="font-medium">3:30 PM - Cake & Refreshments</div>
                <div class="text-sm text-gray-600">Celebration time!</div>
              </div>
            </div>
            <div class="flex gap-4 items-start">
              <div class="w-2 h-2 rounded-full bg-[var(--orange)] mt-2 relative z-10"></div>
              <div>
                <div class="font-medium">4:00 PM - Wrap Up</div>
                <div class="text-sm text-gray-600">Time to say goodbye</div>
              </div>
            </div>
          </div>
        </div>

        <div class="space-y-3 text-sm">
          <div class="flex gap-3">
            <button onclick="handleRSVPResponse('yes')" class="flex-1 py-2 rounded-xl bg-[var(--blue)] text-white">Yes</button>
            <button onclick="handleRSVPResponse('maybe')" class="flex-1 py-2 rounded-xl bg-yellow-500 text-white">Maybe</button>
            <button onclick="handleRSVPResponse('no')" class="flex-1 py-2 rounded-xl bg-red-400 text-white">No</button>
          </div>
        </div>
      </div>

      <!-- RSVP Modal -->
      <div id="rsvpModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-md mx-4 overflow-hidden">
          <!-- Progress bar -->
          <div class="h-1 bg-[var(--gray)]">
            <div id="progressBar" class="h-1 bg-[var(--orange)] transition-all duration-300" style="width: 20%"></div>
          </div>
          
          <!-- Step content -->
          <div class="p-6">
            <div class="steps-container">
              <!-- Step 1: Parent Info -->
              <div class="step" data-step="1">
                <h3 class="text-lg font-semibold mb-4">Your Information</h3>
                <input type="text" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Your full name">
                <input type="email" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Your email">
                <!-- pre filled phone number (we get it from the parent)-->
                <input type="tel" class="w-full border rounded-lg px-3 py-2" value="123-456-7890" placeholder="Your phone number"> 
              </div>

              <!-- Step 2: Child Info -->
              <div class="step hidden" data-step="2">
                <h3 class="text-lg font-semibold mb-4">Child's Information</h3>
                <input type="text" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Child's full name">
                <div class="mb-3">
                  <label class="block text-sm text-gray-600 mb-1">Date of birth</label>
                  <input type="date" class="w-full border rounded-lg px-3 py-2">
                </div>
              </div>

              <!-- Step 3: Health Info -->
              <div class="step hidden" data-step="3">
                <h3 class="text-lg font-semibold mb-4">Health Information</h3>
                <div class="mb-3">
                  <label class="block text-sm text-gray-600 mb-1">Does your child have any allergies?</label>
                  <textarea class="w-full border rounded-lg px-3 py-2 h-20" placeholder="Please list any allergies (food, medical, etc.)"></textarea>
                </div>
                <div class="mb-3">
                  <label class="block text-sm text-gray-600 mb-1">Any other health concerns?</label>
                  <textarea class="w-full border rounded-lg px-3 py-2 h-20" placeholder="Please list any other health concerns or special needs"></textarea>
                </div>
              </div>

              <!-- Step 4: Emergency Contact -->
              <div class="step hidden" data-step="4">
                <h3 class="text-lg font-semibold mb-4">Emergency Contact</h3>
                <!-- add option for "I am the emergency contact"-->
                <label class="flex items-center gap-2">
                  <input type="checkbox" class="accent-[var(--orange)]">
                  <span>I am the emergency contact</span>
                </label>
                <!-- if not, fill in the emergency contact info-->
                <input type="text" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Emergency contact name">
                <input type="tel" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="Emergency contact phone">
                <input type="text" class="w-full border rounded-lg px-3 py-2" placeholder="Relationship to child">
              </div>

              <!-- Step 5: Review -->
              <div class="step hidden" data-step="5">
                <h3 class="text-lg font-semibold mb-4">Review & Confirm</h3>
                <div class="text-sm space-y-2">
                  <p>Please review your information and confirm that everything is correct.</p>
                  <label class="flex items-center gap-2">
                    <input type="checkbox" class="accent-[var(--orange)]">
                    <span>I confirm all information is correct</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Navigation buttons -->
            <div class="flex gap-3 mt-6">
              <button id="prevBtn" onclick="prevStep()" class="flex-1 py-2 rounded-xl border border-gray-200 text-gray-600 hidden">Back</button>
              <button id="nextBtn" onclick="nextStep()" class="flex-1 py-2 rounded-xl bg-[var(--orange)] text-white">Next</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROVIDER PANEL -->
    <section id="provider" class="tab-panel hidden">
      <div class="bg-white rounded-3xl shadow-xl p-6 max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-semibold">Provider Dashboard</h2>
          <div class="flex gap-3">
            <div class="bg-[var(--gray)] rounded-lg px-4 py-2 text-sm">
              <span class="text-gray-500">Today's parties:</span>
              <span class="font-medium ml-1">3</span>
            </div>
            <div class="bg-[var(--gray)] rounded-lg px-4 py-2 text-sm">
              <span class="text-gray-500">This week:</span>
              <span class="font-medium ml-1">12</span>
            </div>
            <button class="bg-[var(--gray)] rounded-lg px-4 py-2 text-sm flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
              </svg>
              Export Data
            </button>
          </div>
        </div>

        <!-- Analytics Cards -->
        <div class="grid grid-cols-3 gap-4 mb-6">
          <!-- Pricing Insights -->
          <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
            <div class="flex justify-between items-start mb-3">
              <h3 class="font-medium">Pricing Insights</h3>
              <span class="text-green-600 text-xs bg-green-100 px-2 py-1 rounded-full">87% Booked</span>
            </div>
            <p class="text-sm text-gray-600 mb-2">Suggested optimizations:</p>
            <ul class="text-sm space-y-2">
              <li class="flex items-center gap-2 text-green-700">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                </svg>
                Raise price $25 on Saturdays
              </li>
              <li class="flex items-center gap-2 text-blue-700">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                Add peak season pricing in June
              </li>
            </ul>
          </div>

          <!-- Tip Performance -->
          <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
            <div class="flex justify-between items-start mb-3">
              <h3 class="font-medium">Tip Performance</h3>
              <span class="text-blue-600 text-xs bg-blue-100 px-2 py-1 rounded-full">Above Avg</span>
            </div>
            <div class="space-y-2">
              <div class="text-sm">
                <div class="flex justify-between mb-1">
                  <span class="text-gray-600">Your Average</span>
                  <span class="font-medium">$42</span>
                </div>
                <div class="h-2 bg-blue-200 rounded-full">
                  <div class="h-2 bg-blue-500 rounded-full" style="width: 85%"></div>
                </div>
              </div>
              <div class="text-sm">
                <div class="flex justify-between mb-1">
                  <span class="text-gray-600">Market Average</span>
                  <span class="font-medium">$35</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full">
                  <div class="h-2 bg-gray-400 rounded-full" style="width: 70%"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Waiver Completion -->
          <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4">
            <div class="flex justify-between items-start mb-3">
              <h3 class="font-medium">Waiver Status</h3>
              <span class="text-orange-600 text-xs bg-orange-100 px-2 py-1 rounded-full">Action Needed</span>
            </div>
            <div class="grid grid-cols-5 gap-1">
              <!-- Each square represents a party's waiver status -->
              <div class="aspect-square rounded bg-green-400" title="All signed"></div>
              <div class="aspect-square rounded bg-green-400" title="All signed"></div>
              <div class="aspect-square rounded bg-yellow-400" title="2 pending"></div>
              <div class="aspect-square rounded bg-red-400" title="None signed"></div>
              <div class="aspect-square rounded bg-green-400" title="All signed"></div>
              <!-- More squares... -->
            </div>
            <div class="mt-2 text-xs text-gray-600">
              3 parties need attention
            </div>
          </div>
        </div>

        <!-- Staff Chat & Coordination -->
        <div class="grid grid-cols-3 gap-4 mb-6">
          <!-- Chat Panel -->
          <div id="staffChat" class="col-span-2 border rounded-xl p-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="font-medium">Staff Chat</h3>
              <button class="text-sm text-[var(--blue)]">Open Photos</button>
            </div>
            <div class="messages h-64 overflow-y-auto space-y-3 mb-4 border-y py-4">
              <!-- Chat messages -->
              <div class="flex gap-3">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                  <span class="text-sm font-medium text-blue-600">JD</span>
                </div>
                <div class="flex-1">
                  <div class="flex justify-between">
                    <span class="text-sm font-medium">John Doe</span>
                    <span class="text-xs text-gray-500">10:30 AM</span>
                  </div>
                  <p class="text-sm text-gray-600">Setup complete for Jackson's party. Extra decorations in place.</p>
                </div>
              </div>
            </div>
            <div class="flex gap-2">
              <input type="text" placeholder="Type a message..." class="flex-1 border rounded-lg px-3 py-2 text-sm">
              <button class="px-4 py-2 bg-[var(--blue)] text-white rounded-lg">Send</button>
            </div>
          </div>

          <!-- Quick Export Tools -->
          <div id="exportTools" class="border rounded-xl p-4">
            <h3 class="font-medium mb-4">Export Tools</h3>
            <div class="space-y-3">
              <button data-type="revenue" class="w-full flex items-center gap-2 px-4 py-2 border rounded-lg text-sm hover:bg-gray-50">
                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Revenue Report (CSV)
              </button>
              <button data-type="quickbooks" class="w-full flex items-center gap-2 px-4 py-2 border rounded-lg text-sm hover:bg-gray-50">
                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                QuickBooks Export
              </button>
              <button data-type="calendar" class="w-full flex items-center gap-2 px-4 py-2 border rounded-lg text-sm hover:bg-gray-50">
                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Calendar Export
              </button>
              <button data-type="tax" class="w-full flex items-center gap-2 px-4 py-2 border rounded-lg text-sm hover:bg-gray-50">
                <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Tax Categories
              </button>
            </div>
          </div>
        </div>

        <!-- Availability Calendar -->
        <div class="border rounded-xl p-4 mb-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="font-medium">Availability Calendar</h3>
            <div class="flex gap-2 text-sm">
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                Available
              </span>
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                Tentative
              </span>
              <span class="flex items-center gap-1">
                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                Booked
              </span>
            </div>
          </div>
          <div class="grid grid-cols-7 gap-2">
            <!-- Calendar header -->
            <div class="text-center text-sm text-gray-500 py-2">Mon</div>
            <div class="text-center text-sm text-gray-500 py-2">Tue</div>
            <div class="text-center text-sm text-gray-500 py-2">Wed</div>
            <div class="text-center text-sm text-gray-500 py-2">Thu</div>
            <div class="text-center text-sm text-gray-500 py-2">Fri</div>
            <div class="text-center text-sm text-gray-500 py-2">Sat</div>
            <div class="text-center text-sm text-gray-500 py-2">Sun</div>
            
            <!-- Calendar days -->
            <div id="day1" class="calendar-day border rounded-lg p-2 min-h-[100px] bg-green-50" draggable="true">
              <div class="text-sm font-medium">1</div>
              <div class="time-slots mt-2 space-y-1">
                <div class="time-slot text-xs px-1 py-0.5 rounded bg-green-500 text-white">10:00 AM</div>
                <div class="time-slot text-xs px-1 py-0.5 rounded bg-green-500 text-white">2:00 PM</div>
              </div>
            </div>
            <div id="day2" class="calendar-day border rounded-lg p-2 min-h-[100px] bg-yellow-50" draggable="true">
              <div class="text-sm font-medium">2</div>
              <div class="time-slots mt-2 space-y-1">
                <div class="time-slot text-xs px-1 py-0.5 rounded bg-yellow-500 text-white">1:00 PM</div>
              </div>
            </div>
            <div id="day3" class="calendar-day border rounded-lg p-2 min-h-[100px] bg-red-50" draggable="true">
              <div class="text-sm font-medium">3</div>
              <div class="time-slots mt-2 space-y-1">
                <div class="time-slot text-xs px-1 py-0.5 rounded bg-red-500 text-white">All Booked</div>
              </div>
            </div>
            <!-- More days... -->
          </div>
        </div>

        <!-- Party List -->
        <div class="space-y-4">
          <!-- Today's Parties -->
          <div class="font-medium text-gray-500 mb-2">Today</div>
          <div class="grid gap-4">
            <!-- Party Card -->
            <div class="party-card border rounded-xl p-4 hover:shadow-md transition-shadow">
              <div class="flex items-start gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="party-name font-medium">Jackson's 6th Birthday</span>
                    <span class="bg-[var(--blue)] text-white text-xs px-2 py-0.5 rounded-full">2:00 PM</span>
                  </div>
                  <div class="grid grid-cols-3 gap-6 mb-4">
                    <div class="text-sm">
                      <div class="text-gray-500">Guests</div>
                      <div>12 confirmed</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Package</div>
                      <div>Adventure Plus</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Status</div>
                      <div class="text-green-600">Ready</div>
                    </div>
                  </div>
                  <div class="flex gap-2 text-sm">
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">View Details</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Message Parent</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Staff Notes</button>
                  </div>
                </div>
                <div class="flex gap-2">
                  <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600" title="All waivers signed">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                  </div>
                  <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600" title="Payment completed">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Another Party Card -->
            <div class="party-card border rounded-xl p-4 hover:shadow-md transition-shadow">
              <div class="flex items-start gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="party-name font-medium">Emma's Princess Party</span>
                    <span class="bg-[var(--blue)] text-white text-xs px-2 py-0.5 rounded-full">4:30 PM</span>
                  </div>
                  <div class="grid grid-cols-3 gap-6 mb-4">
                    <div class="text-sm">
                      <div class="text-gray-500">Guests</div>
                      <div>8 confirmed</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Package</div>
                      <div>Royal Package</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Status</div>
                      <div class="text-yellow-600">Needs Setup</div>
                    </div>
                  </div>
                  <div class="flex gap-2 text-sm">
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">View Details</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Message Parent</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Staff Notes</button>
                  </div>
                </div>
                <div class="flex gap-2">
                  <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600" title="2 waivers pending">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600" title="Payment completed">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tomorrow's Parties -->
          <div class="font-medium text-gray-500 mt-8 mb-2">Tomorrow</div>
          <div class="grid gap-4">
            <!-- Party Card -->
            <div class="party-card border rounded-xl p-4 hover:shadow-md transition-shadow">
              <div class="flex items-start gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="party-name font-medium">Lucas' Superhero Party</span>
                    <span class="bg-[var(--blue)] text-white text-xs px-2 py-0.5 rounded-full">1:00 PM</span>
                  </div>
                  <div class="grid grid-cols-3 gap-6 mb-4">
                    <div class="text-sm">
                      <div class="text-gray-500">Guests</div>
                      <div>15 confirmed</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Package</div>
                      <div>Hero Ultimate</div>
                    </div>
                    <div class="text-sm">
                      <div class="text-gray-500">Status</div>
                      <div class="text-purple-600">Draft</div>
                    </div>
                  </div>
                  <div class="flex gap-2 text-sm">
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">View Details</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Message Parent</button>
                    <button class="px-3 py-1 rounded-lg bg-[var(--gray)] text-gray-600">Staff Notes</button>
                  </div>
                </div>
                <div class="flex gap-2">
                  <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600" title="No waivers yet">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </div>
                  <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600" title="Partial payment">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Party Details Modal -->
      <div id="partyDetailsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-4xl mx-4 overflow-hidden">
          <div class="flex justify-between items-center p-6 border-b">
            <h3 class="text-xl font-semibold party-title">Party Details</h3>
            <button onclick="closeModal('partyDetailsModal')" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          
          <div class="p-6">
            <div class="grid grid-cols-3 gap-6">
              <!-- Main Info -->
              <div class="col-span-2 space-y-6">
                <div class="flex items-center gap-4">
                  <div class="flex-1">
                    <div class="text-sm text-gray-500">Birthday Child</div>
                    <div class="text-lg font-medium party-child">Jackson</div>
                  </div>
                  <div>
                    <div class="text-sm text-gray-500">Age</div>
                    <div class="text-lg font-medium party-age">6</div>
                  </div>
                  <div>
                    <div class="text-sm text-gray-500">Date & Time</div>
                    <div class="text-lg font-medium party-datetime">Mar 23, 2:00 PM</div>
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                  <div class="border rounded-lg p-4">
                    <div class="text-sm font-medium mb-2">Package Details</div>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>Base Package</span>
                        <span class="font-medium">Adventure Plus ($299)</span>
                      </div>
                      <div class="flex justify-between text-green-600">
                        <span>Add-ons</span>
                        <span>+ $150</span>
                      </div>
                      <div class="flex justify-between text-blue-600">
                        <span>Extra Time</span>
                        <span>+ $50</span>
                      </div>
                      <div class="pt-2 border-t flex justify-between font-medium">
                        <span>Total</span>
                        <span>$499</span>
                      </div>
                    </div>
                  </div>

                  <div class="border rounded-lg p-4">
                    <div class="text-sm font-medium mb-2">Guest Status</div>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span>Invited</span>
                        <span class="font-medium">15</span>
                      </div>
                      <div class="flex justify-between text-green-600">
                        <span>Confirmed</span>
                        <span>12</span>
                      </div>
                      <div class="flex justify-between text-yellow-600">
                        <span>Maybe</span>
                        <span>2</span>
                      </div>
                      <div class="flex justify-between text-red-600">
                        <span>Declined</span>
                        <span>1</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="border rounded-lg p-4">
                  <div class="text-sm font-medium mb-2">Special Requirements</div>
                  <div class="space-y-3 text-sm">
                    <div>
                      <div class="font-medium text-red-600">Allergies</div>
                      <div>Peanuts (2 guests), Dairy (1 guest)</div>
                    </div>
                    <div>
                      <div class="font-medium text-blue-600">Accessibility</div>
                      <div>Wheelchair access needed for one parent</div>
                    </div>
                    <div>
                      <div class="font-medium text-purple-600">Special Requests</div>
                      <div>Superhero-themed decorations, Gluten-free cake option</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Side Panel -->
              <div class="space-y-4">
                <div class="border rounded-lg p-4">
                  <div class="text-sm font-medium mb-2">Parent Contact</div>
                  <div class="space-y-2 text-sm">
                    <div>
                      <div class="text-gray-500">Name</div>
                      <div>Sarah Johnson</div>
                    </div>
                    <div>
                      <div class="text-gray-500">Phone</div>
                      <div>+1 (555) 123-4567</div>
                    </div>
                    <div>
                      <div class="text-gray-500">Email</div>
                      <div>sarah.j@email.com</div>
                    </div>
                  </div>
                  <button class="w-full mt-3 px-3 py-2 bg-[var(--blue)] text-white rounded-lg text-sm">Message Parent</button>
                </div>

                <div class="border rounded-lg p-4">
                  <div class="text-sm font-medium mb-2">Staff Assigned</div>
                  <div class="space-y-2">
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                        <span class="text-sm font-medium text-blue-600">JD</span>
                      </div>
                      <div class="text-sm">John Doe (Lead)</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center">
                        <span class="text-sm font-medium text-green-600">AS</span>
                      </div>
                      <div class="text-sm">Amy Smith</div>
                    </div>
                  </div>
                  <button class="w-full mt-3 px-3 py-2 border rounded-lg text-sm">Manage Staff</button>
                </div>

                <div class="border rounded-lg p-4">
                  <div class="text-sm font-medium mb-2">Quick Actions</div>
                  <div class="space-y-2">
                    <button class="w-full px-3 py-2 bg-[var(--orange)] text-white rounded-lg text-sm">Edit Party Details</button>
                    <button class="w-full px-3 py-2 border rounded-lg text-sm">Print Party Sheet</button>
                    <button class="w-full px-3 py-2 border rounded-lg text-sm">Send Reminder</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Staff Notes Modal -->
      <div id="staffNotesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl w-full max-w-4xl mx-4 overflow-hidden">
          <div class="flex justify-between items-center p-6 border-b">
            <h3 class="text-xl font-semibold party-title">Staff Notes</h3>
            <button onclick="closeModal('staffNotesModal')" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          
          <div class="p-6">
            <div class="grid grid-cols-3 gap-6">
              <!-- Notes List -->
              <div class="col-span-2 space-y-4">
                <div class="flex justify-between items-center">
                  <h4 class="font-medium">Notes & Updates</h4>
                  <div class="flex gap-2">
                    <button class="px-3 py-1 text-sm border rounded-lg">Filter</button>
                    <button class="px-3 py-1 text-sm bg-[var(--blue)] text-white rounded-lg">Add Note</button>
                  </div>
                </div>

                <div class="space-y-4">
                  <!-- Note Entry -->
                  <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                      <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                          <span class="text-sm font-medium text-blue-600">JD</span>
                        </div>
                        <div>
                          <div class="font-medium">John Doe</div>
                          <div class="text-xs text-gray-500">Mar 22, 10:30 AM</div>
                        </div>
                      </div>
                      <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-600">Setup</span>
                    </div>
                    <p class="text-sm text-gray-600">Confirmed all decorations are in stock. Will need extra time for balloon arch setup.</p>
                  </div>

                  <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                      <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                          <span class="text-sm font-medium text-purple-600">MM</span>
                        </div>
                        <div>
                          <div class="font-medium">Mike Miller</div>
                          <div class="text-xs text-gray-500">Mar 21, 2:15 PM</div>
                        </div>
                      </div>
                      <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-600">Planning</span>
                    </div>
                    <p class="text-sm text-gray-600">Parent requested superhero-themed plates and napkins. Added to inventory order.</p>
                  </div>
                </div>
              </div>

              <!-- Quick Add Note -->
              <div class="space-y-4">
                <div class="border rounded-lg p-4">
                  <h4 class="font-medium mb-3">Quick Note</h4>
                  <div class="space-y-3">
                    <select class="w-full border rounded-lg px-3 py-2 text-sm">
                      <option>Select Category</option>
                      <option>Setup</option>
                      <option>Planning</option>
                      <option>Staff</option>
                      <option>Parent Request</option>
                      <option>Issue</option>
                    </select>
                    <textarea class="w-full border rounded-lg px-3 py-2 text-sm h-32" placeholder="Type your note here..."></textarea>
                    <button class="w-full px-3 py-2 bg-[var(--orange)] text-white rounded-lg text-sm">Add Note</button>
                  </div>
                </div>

                <div class="border rounded-lg p-4">
                  <h4 class="font-medium mb-2">Note Templates</h4>
                  <div class="space-y-2">
                    <button class="w-full px-3 py-2 text-left text-sm border rounded-lg hover:bg-gray-50">🎨 Setup Checklist</button>
                    <button class="w-full px-3 py-2 text-left text-sm border rounded-lg hover:bg-gray-50">🎂 Food Preparation</button>
                    <button class="w-full px-3 py-2 text-left text-sm border rounded-lg hover:bg-gray-50">👥 Staff Briefing</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      // Tab functionality
      const buttons=document.querySelectorAll('.tab-btn');
      const panels=document.querySelectorAll('.tab-panel');
      
      const open=id=>{
        panels.forEach(p=>p.classList.toggle('hidden',p.id!==id));
        buttons.forEach(b=>b.classList.toggle('ring-2',b.dataset.tab===id));
      };
      
      buttons.forEach(b=>b.addEventListener('click',()=>{
        open(b.dataset.tab);
        // Update URL when tab is clicked
        const url = new URL(window.location);
        url.searchParams.set('tab', b.dataset.tab);
        window.history.pushState({}, '', url);
      }));

      // Check URL parameters for initial tab
      const urlParams = new URLSearchParams(window.location.search);
      const tabParam = urlParams.get('tab');
      if (tabParam && ['guest', 'parent', 'provider'].includes(tabParam)) {
        open(tabParam);
      } else {
        open('parent'); // Default tab
      }

      // copy invite link
      const copyBtn=document.getElementById('copyLink');
      if(copyBtn){copyBtn.addEventListener('click',()=>{navigator.clipboard.writeText(document.getElementById('inviteLink').value);copyBtn.textContent='Copied!';setTimeout(()=>copyBtn.textContent='Copy',1500);});}

      // Provider Dashboard Functionality
      if (document.getElementById('provider')) {
        initializeProviderDashboard();
      }
    });

    // RSVP Modal Functionality
    let currentStep = 1;
    const totalSteps = 5;
    let rsvpStatus = '';

    function openRSVPModal(status) {
      rsvpStatus = status;
      document.getElementById('rsvpModal').classList.remove('hidden');
      updateStep();
    }

    function closeRSVPModal() {
      document.getElementById('rsvpModal').classList.add('hidden');
      currentStep = 1;
      updateStep();
    }

    function updateStep() {
      // Update progress bar
      document.getElementById('progressBar').style.width = `${(currentStep / totalSteps) * 100}%`;
      
      // Show/hide steps
      document.querySelectorAll('.step').forEach(step => {
        step.classList.toggle('hidden', parseInt(step.dataset.step) !== currentStep);
      });

      // Update buttons
      document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
      const nextBtn = document.getElementById('nextBtn');
      nextBtn.textContent = currentStep === totalSteps ? 'Submit' : 'Next';
    }

    function nextStep() {
      if (currentStep === totalSteps) {
        // Handle form submission
        closeRSVPModal();
        return;
      }
      currentStep = Math.min(currentStep + 1, totalSteps);
      updateStep();
    }

    function prevStep() {
      currentStep = Math.max(currentStep - 1, 1);
      updateStep();
    }

    // Close modal when clicking outside
    document.getElementById('rsvpModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('rsvpModal')) {
        closeRSVPModal();
      }
    });

    // Invite Modal Functionality
    function openInviteModal() {
      document.getElementById('inviteModal').classList.remove('hidden');
      if (document.querySelectorAll('.guest-entry').length === 0) {
        addGuestEntry(); // Add first entry automatically
      }
    }

    function closeInviteModal() {
      document.getElementById('inviteModal').classList.add('hidden');
    }

    function addGuestEntry() {
      const guestList = document.getElementById('guestList');
      const entryId = Date.now(); // Unique ID for the entry
      
      const entry = document.createElement('div');
      entry.className = 'guest-entry bg-[var(--gray)] rounded-xl p-4 relative';
      entry.innerHTML = `
        <button onclick="removeGuestEntry(${entryId})" class="absolute right-2 top-2 text-gray-400 hover:text-gray-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <div class="space-y-3">
          <input type="text" placeholder="Guest Name" class="w-full border rounded-lg px-3 py-2 text-sm" />
          <div class="grid grid-cols-7 gap-2 items-center">
            <input type="email" placeholder="Email" class="col-span-3 border rounded-lg px-3 py-2 text-sm" />
            <div class="text-center text-sm text-gray-400">or</div>
            <input type="tel" placeholder="Phone" class="col-span-3 border rounded-lg px-3 py-2 text-sm" />
          </div>
        </div>
      `;
      
      guestList.appendChild(entry);
    }

    function removeGuestEntry(entryId) {
      const entry = document.querySelector(`.guest-entry button[onclick="removeGuestEntry(${entryId})"]`).parentNode;
      entry.remove();
    }

    function sendInvites() {
      const entries = document.querySelectorAll('.guest-entry');
      const guests = Array.from(entries).map(entry => {
        return {
          name: entry.querySelector('input[type="text"]').value,
          email: entry.querySelector('input[type="email"]').value,
          phone: entry.querySelector('input[type="tel"]').value
        };
      });
      
      // Here you would typically send this data to your backend
      console.log('Sending invites to:', guests);
      
      // Show success message
      const successMsg = document.createElement('div');
      successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg';
      successMsg.textContent = 'Invites sent successfully!';
      document.body.appendChild(successMsg);
      
      // Remove success message after 3 seconds
      setTimeout(() => {
        successMsg.remove();
        closeInviteModal();
      }, 3000);
    }

    // Close modal when clicking outside
    document.getElementById('inviteModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('inviteModal')) {
        closeInviteModal();
      }
    });

    // Provider Dashboard Initialization
    function initializeProviderDashboard() {
      initializeChat();
      initializeCalendar();
      initializeExports();
      initializePartyCards();
    }

    // Chat Functionality
    function initializeChat() {
      const chatInput = document.querySelector('#staffChat input');
      const chatSend = document.querySelector('#staffChat button');
      const chatMessages = document.querySelector('#staffChat .messages');

      if (chatInput && chatSend && chatMessages) {
        chatSend.addEventListener('click', () => sendChatMessage(chatInput.value));
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendChatMessage(chatInput.value);
        });
      }
    }

    function sendChatMessage(message) {
      if (!message.trim()) return;
      
      const chatMessages = document.querySelector('#staffChat .messages');
      const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      const messageHTML = `
        <div class="flex gap-3 animate-fade-in">
          <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
            <span class="text-sm font-medium text-blue-600">ME</span>
          </div>
          <div class="flex-1">
            <div class="flex justify-between">
              <span class="text-sm font-medium">You</span>
              <span class="text-xs text-gray-500">${timestamp}</span>
            </div>
            <p class="text-sm text-gray-600">${message}</p>
          </div>
        </div>
      `;
      
      chatMessages.insertAdjacentHTML('beforeend', messageHTML);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      document.querySelector('#staffChat input').value = '';
    }

    // Calendar Functionality
    function initializeCalendar() {
      const calendarDays = document.querySelectorAll('.calendar-day');
      
      calendarDays.forEach(day => {
        // Make days draggable
        day.addEventListener('dragstart', handleDragStart);
        day.addEventListener('dragover', handleDragOver);
        day.addEventListener('drop', handleDrop);
        
        // Add time slot functionality
        const timeSlots = day.querySelectorAll('.time-slot');
        timeSlots.forEach(slot => {
          slot.addEventListener('click', () => toggleTimeSlot(slot));
        });
      });
    }

    function handleDragStart(e) {
      e.dataTransfer.setData('text/plain', e.target.id);
      e.target.classList.add('opacity-50');
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleDrop(e) {
      e.preventDefault();
      const sourceId = e.dataTransfer.getData('text/plain');
      const source = document.getElementById(sourceId);
      const target = e.target.closest('.calendar-day');
      
      if (source && target) {
        // Swap the time slots between days
        const sourceSlots = source.querySelector('.time-slots').innerHTML;
        const targetSlots = target.querySelector('.time-slots').innerHTML;
        source.querySelector('.time-slots').innerHTML = targetSlots;
        target.querySelector('.time-slots').innerHTML = sourceSlots;
        
        // Update status colors
        updateDayStatus(source);
        updateDayStatus(target);
      }
      
      source.classList.remove('opacity-50');
    }

    function toggleTimeSlot(slot) {
      const states = ['bg-green-500', 'bg-yellow-500', 'bg-red-500'];
      const currentState = states.find(state => slot.classList.contains(state));
      const currentIndex = states.indexOf(currentState);
      const nextIndex = (currentIndex + 1) % states.length;
      
      states.forEach(state => slot.classList.remove(state));
      slot.classList.add(states[nextIndex]);
      
      updateDayStatus(slot.closest('.calendar-day'));
    }

    function updateDayStatus(day) {
      const slots = day.querySelectorAll('.time-slot');
      const hasRed = Array.from(slots).some(slot => slot.classList.contains('bg-red-500'));
      const hasYellow = Array.from(slots).some(slot => slot.classList.contains('bg-yellow-500'));
      const hasGreen = Array.from(slots).some(slot => slot.classList.contains('bg-green-500'));
      
      day.classList.remove('bg-red-50', 'bg-yellow-50', 'bg-green-50');
      if (hasRed) day.classList.add('bg-red-50');
      else if (hasYellow) day.classList.add('bg-yellow-50');
      else if (hasGreen) day.classList.add('bg-green-50');
    }

    // Export Functionality
    function initializeExports() {
      const exportButtons = document.querySelectorAll('#exportTools button');
      
      exportButtons.forEach(button => {
        button.addEventListener('click', () => handleExport(button.dataset.type));
      });
    }

    function handleExport(type) {
      // Show loading state
      const button = document.querySelector(`[data-type="${type}"]`);
      const originalText = button.textContent;
      button.innerHTML = '<span class="animate-spin">↻</span> Exporting...';
      
      // Simulate export process
      setTimeout(() => {
        button.textContent = '✓ Exported!';
        
        // Show success message
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg animate-fade-in';
        toast.textContent = `${type} exported successfully!`;
        document.body.appendChild(toast);
        
        // Reset button and remove toast
        setTimeout(() => {
          button.textContent = originalText;
          toast.remove();
        }, 3000);
      }, 1500);
    }

    // Party Card Functionality
    function initializePartyCards() {
      const actionButtons = document.querySelectorAll('.party-card button');
      
      actionButtons.forEach(button => {
        button.addEventListener('click', () => handlePartyAction(button));
      });
    }

    function handlePartyAction(button) {
      const action = button.textContent.toLowerCase();
      const card = button.closest('.party-card');
      const partyName = card.querySelector('.party-name').textContent;
      
      switch (action) {
        case 'view details':
          showPartyDetails(partyName);
          break;
        case 'message parent':
          openParentMessage(partyName);
          break;
        case 'staff notes':
          openStaffNotes(partyName);
          break;
      }
    }

    function showPartyDetails(partyName) {
      const modal = document.getElementById('partyDetailsModal');
      modal.classList.remove('hidden');
      modal.querySelector('.party-title').textContent = `Party Details - ${partyName}`;
      
      // Would typically fetch party details from backend here
      // For now, we'll just show the modal with sample data
    }

    function openParentMessage(partyName) {
      const chatInput = document.querySelector('#staffChat input');
      chatInput.value = `Re: ${partyName} - `;
      chatInput.focus();
    }

    function openStaffNotes(partyName) {
      const modal = document.getElementById('staffNotesModal');
      modal.classList.remove('hidden');
      modal.querySelector('.party-title').textContent = `Staff Notes - ${partyName}`;
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    // Close modals when clicking outside
    document.querySelectorAll('#partyDetailsModal, #staffNotesModal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModal(modal.id);
        }
      });
    });

    // Add some CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.3s ease-out;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .animate-spin {
        display: inline-block;
        animation: spin 1s linear infinite;
      }
    `;
    document.head.appendChild(style);

    function handleRSVPResponse(response) {
      if (response === 'yes') {
        // Trigger confetti with a festive pattern
        const end = Date.now() + (3 * 1000); // 3 seconds of confetti

        // Launch confetti from both sides
        const colors = ['#ff0000', '#ffa500', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#8f00ff'];
        
        (function frame() {
          confetti({
            particleCount: 7,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
            colors: colors
          });
          
          confetti({
            particleCount: 7,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
            colors: colors
          });

          if (Date.now() < end) {
            requestAnimationFrame(frame);
          }
        }());

        // Add some finale bursts after 2 seconds
        setTimeout(() => {
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: colors
          });
        }, 2000);
      }
      
      // Open the modal and handle the response
      openRSVPModal(response);
    }
  </script>
</body>
</html>
